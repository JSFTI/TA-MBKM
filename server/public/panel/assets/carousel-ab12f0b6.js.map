{"version":3,"file":"carousel-ab12f0b6.js","sources":["../../../../panel/src/pages/settings/carousel.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { sortBy } from 'lodash';\nimport dayjs from 'dayjs';\nimport { useUser } from '~/stores/useUser';\n\nconst toast = useToast();\nconst user = useUser();\nconst approvedCarousels = ref<Carousel[]>([]);\nconst carousels = ref<Carousel[]>([]);\nconst fileHovering = ref(false);\nconst isDirty = ref(false);\n\nfunction fileDragging(e: DragEvent) {\n  e.preventDefault();\n}\n\nfunction fileEnter(e: DragEvent) {\n  e.preventDefault();\n\n  if ((e.dataTransfer?.items.length ?? 0) === 0)\n    return;\n\n  fileHovering.value = true;\n}\n\nfunction fileLeave(e: DragEvent) {\n  e.preventDefault();\n  if ((e.target as HTMLElement).id !== 'carousel-card')\n    return;\n\n  fileHovering.value = false;\n}\n\nfunction fileDrop(e: DragEvent) {\n  e.preventDefault();\n  fileHovering.value = false;\n  if (e.dataTransfer?.files.length)\n    addImages(e.dataTransfer.files);\n}\n\nfunction handleChange(e: Event) {\n  const target = e.target as HTMLInputElement;\n\n  if (target.files) {\n    addImages(target.files);\n    target.value = '';\n  }\n}\n\nfunction addImages(images: FileList) {\n  const formData = new FormData();\n\n  for (let i = 0; i < images.length; i++)\n    formData.append('images[]', images[i], images[i].name);\n\n  axios.post<Carousel[]>('carousels', formData)\n    .then((res) => {\n      carousels.value.push(...res.data);\n      carousels.value = sortBy(carousels.value, [x => x.filename?.toLowerCase()]);\n    });\n}\n\nfunction handleApprove(carousel: Carousel) {\n  axios.put<Carousel>(`/carousels/${carousel.id}/approved`)\n    .then((res) => {\n      Object.assign(carousel, res.data);\n\n      approvedCarousels.value.push(carousel);\n      carousels.value = carousels.value.filter(x => !x.approved);\n    });\n}\n\nfunction handleDisapprove(carousel: Carousel) {\n  axios.delete<Carousel>(`/carousels/${carousel.id}/approved`)\n    .then((res) => {\n      Object.assign(carousel, res.data);\n\n      approvedCarousels.value = approvedCarousels.value.filter(x => x.id !== carousel.id);\n      carousels.value.push(carousel);\n      carousels.value = carousels.value.filter(x => !x.approved);\n    });\n}\n\nfunction handleSaveOrder() {\n  const data = approvedCarousels.value.map((x, i) => {\n    x.priority = i + 1;\n    return x;\n  })\n\n  axios.patch('carousels/approved', data).then(() => {\n    approvedCarousels.value = data;\n    toast.success('Carousel order updated.');\n  });\n}\n\nfunction handleDelete(id: number) {\n  axios.delete(`/carousels/${id}`)\n    .then(() => {\n      approvedCarousels.value = approvedCarousels.value.filter(x => x.id !== id);\n      carousels.value = carousels.value.filter(x => x.id !== id);\n    });\n}\n\naxios.get<Carousel[]>('carousels')\n  .then((res) => {\n    carousels.value = res.data;\n    approvedCarousels.value = carousels.value\n      .filter(x => x.approved)\n      .map(x => ({ ...x, priority: x.priority ?? Number.MAX_SAFE_INTEGER }))\n      .sort((a, b) => (a.priority - b.priority) || dayjs(a.approved_at).diff(dayjs(b.approved_at)));\n  });\n\nconst nonApprovedCarousels = computed(() => {\n  return sortBy(carousels.value.filter(x => !x.approved), [x => x.filename?.toLowerCase()]);\n});\n</script>\n\n<template>\n  <VCard title=\"Carousel Setting\">\n    <div class=\"p-5\">\n      <div v-if=\"user.role?.name === 'admin'\">\n        <Draggable\n          v-if=\"approvedCarousels.length > 0\"\n          v-model=\"approvedCarousels\" item-key=\"id\"\n          class=\"flex gap-5 flex-wrap justify-center\"\n          @change=\"(isDirty = true)\"\n        >\n          <template #item=\"{ element }\">\n            <VCard\n              class=\"cursor-pointer rounded-0 !w-50 !flex items-center gap-5 flex-col\" flat\n            >\n              <img draggable=\"false\" class=\"object-cover !w-50 aspect-ratio-16/9\" :src=\"element.url\" />\n              <VCardText class=\"!py-0\">\n                <p class=\"text-center\">\n                  {{ element.filename }}\n                </p>\n              </VCardText>\n              <VCardActions class=\"!py-0 flex gap-5 justify-center\">\n                <VBtn icon=\"i-mdi:cancel\" size=\"small\" class=\"!bg-danger !text-black\" @click=\"handleDisapprove(element)\" />\n                <VBtn icon=\"i-mdi:trash-can\" size=\"small\" class=\"!bg-danger !text-black\" @click=\"handleDelete(element.id)\" />\n              </VCardActions>\n            </VCard>\n          </template>\n        </Draggable>\n        <div v-else class=\"text-center text-3xl\">\n          No Approved Carousel\n        </div>\n        <div class=\"text-center mt-10\">\n          <VBtn color=\"primary\" @click=\"handleSaveOrder\">\n            Update Carousel Order\n          </VBtn>\n        </div>\n      </div>\n      <VCard\n        id=\"carousel-card\"\n        :class=\"{ 'is-file-hovering': fileHovering }\"\n        @dragover=\"fileDragging\"\n        @dragenter=\"fileEnter\"\n        @dragleave=\"fileLeave\"\n        @drop=\"fileDrop\"\n      >\n        <div\n          class=\"pointer-events-none absolute z-100 top-0 left-0 w-full h-full bg-light bg-opacity-50 items-center justify-center flex flex-col opacity-0 transition\"\n          :class=\"{\n            '!opacity-100': fileHovering,\n          }\"\n        >\n          <div class=\"i-mdi:upload text-7xl text-dark\" />\n          <div class=\"select-none text-dark font-bold\">\n            Drop Carousel\n          </div>\n        </div>\n        <VToolbar title=\"Carousels\" color=\"rgba(0,0,0,0)\">\n          <VToolbarItems>\n            <VBtn icon=\"i-ic:round-add\" class=\"!bg-success !text-white\" tag=\"label\" for=\"carousel\" />\n            <input\n              id=\"carousel\" type=\"file\" class=\"w-0 h-0 invisible m-0 p-0\"\n              multiple accept=\"image/*\" @change=\"handleChange\"\n            />\n          </VToolbarItems>\n        </VToolbar>\n        <VCardText>\n          <div v-if=\"nonApprovedCarousels.length > 0\" class=\"flex gap-5 flex-wrap\">\n            <VCard\n              v-for=\"carousel in nonApprovedCarousels\" :key=\"carousel.id\"\n              class=\"rounded-0 !w-60 !flex items-center gap-5 flex-col\" flat\n            >\n              <img draggable=\"false\" class=\"object-cover !w-60 aspect-ratio-16/9\" :src=\"carousel.url\" />\n              <VCardText class=\"!py-0\">\n                <p class=\"text-center\">\n                  {{ carousel.filename }}\n                </p>\n              </VCardText>\n              <VCardActions class=\"!py-0 flex gap-5\">\n                <VBtn icon=\"i-mdi:check\" size=\"small\" class=\"!bg-success !text-black\" @click=\"handleApprove(carousel)\" />\n                <VBtn icon=\"i-mdi:trash-can\" size=\"small\" class=\"!bg-danger !text-black\" @click=\"handleDelete(carousel.id!)\" />\n              </VCardActions>\n            </VCard>\n          </div>\n          <div v-else class=\"text-3xl text-center\">\n            No Available Carousel\n          </div>\n        </VCardText>\n      </VCard>\n    </div>\n  </VCard>\n</template>\n"],"names":["toast","useToast","user","useUser","approvedCarousels","ref","carousels","fileHovering","isDirty","fileDragging","fileEnter","_a","fileLeave","fileDrop","addImages","handleChange","target","images","formData","i","axios","res","sortBy","x","handleApprove","carousel","handleDisapprove","handleSaveOrder","data","handleDelete","id","b","dayjs","nonApprovedCarousels","computed"],"mappings":"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"}