{"version":3,"file":"new-b55c1e55.js","sources":["../../../../panel/src/components/Form/ProductDetailForm.vue","../../../../panel/src/pages/products/new.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { AxiosError } from 'axios';\nimport { uniqBy } from 'lodash';\n\nconst props = defineProps({\n  id: { default: null }\n});\n\nconst initForm = {\n  name: '',\n  category_id: null,\n  price: null,\n  stock: 0 as number | null,\n  published: false,\n  tags: [] as Tag[],\n};\n\nconst initInvalidFeedbacks = {\n  name: '',\n  category_id: '',\n  price: '',\n  stock: '',\n  published: '',\n};\n\nconst router = useRouter();\nconst form = reactive({ ...initForm });\nconst invalidFeedbacks = reactive({ ...initInvalidFeedbacks });\nconst categories = ref<Category[]>([]);\nconst tags = ref<Tag[]>([]);\nconst loading = reactive({\n  form: false,\n  search: false,\n});\n\naxios.get('categories')\n  .then((res) => {\n    categories.value = res.data;\n  });\n\nconst searchTag = useDebounceFn((search: string) => {\n  if (search.length === 0) {\n    tags.value = [];\n    return;\n  }\n  loading.search = true;\n  axios.get<Tag[]>('tags', {\n    params: {\n      search,\n    },\n  }).then((res) => {\n    const currentTagIds: number[] = form.tags.map(x => x.id!);\n\n    tags.value = res.data.filter(x => !currentTagIds.includes(x.id!));\n\n    if (search && (!res.data.length || res.data.find(x => x.name !== search))) {\n      tags.value.unshift({\n        id: 0,\n        name: search,\n      });\n    } else {\n      tags.value = tags.value.filter(x => !!x.id);\n    }\n  }).finally(() => {\n    loading.search = false;\n  });\n}, 200);\n\nasync function handleSubmit() {\n  loading.form = true;\n  Object.assign(invalidFeedbacks, initInvalidFeedbacks);\n\n  const formData = { ...form };\n  formData.tags = formData.tags.map(x => x.name) as any;\n\n  try {\n    if (props.id) {\n      await axios.put(`products/${props.id}`, formData);\n      return;\n    }\n    const res = await axios.post<Product>('products', formData);\n    router.push(`/products/${res.data.id}`);\n  } catch (e: unknown) {\n    if (e instanceof AxiosError<ApiInvalidFeedback>)\n      Object.assign(invalidFeedbacks, e.response!.data.errors);\n  } finally {\n    loading.form = false;\n  }\n}\n\nwatch(() => form.tags.length, () => {\n  form.tags = uniqBy(form.tags, 'name');\n});\n</script>\n\n<template>\n  <VForm @submit.prevent=\"handleSubmit\">\n    <div class=\"flex flex-col gap-2 py-5\">\n      <VTextField v-model=\"form.name\" label=\"Product Name\" />\n      <ACurrencyInput v-model=\"form.price\" label=\"Price\" inputmode=\"numeric\" />\n      <div class=\"flex gap-5 items-center mb-5\">\n        <VCheckboxBtn\n          :model-value=\"(form.stock !== null)\"\n          @update:model-value=\"(form.stock = form.stock === null ? 0 : null)\"\n        />\n        <VTextField\n          v-model=\"form.stock\" type=\"number\" min=\"0\" label=\"Stock\" :disabled=\"(form.stock === null)\"\n          hide-details\n          hint=\"Disable if stock is infinite\"\n        />\n      </div>\n      <VSelect v-model=\"form.category_id\" :items=\"categories\" item-title=\"name\" item-value=\"id\" label=\"Category\" />\n      <VAutocomplete\n        v-model=\"form.tags\" :items=\"tags\" multiple label=\"Tags\"\n        item-title=\"name\" item-value=\"name\" chips closable-chips\n        return-object placeholder=\"Duplicate tags will be truncated\"\n        :loading=\"loading.search\" @update:search=\"searchTag\"\n      >\n        <template #chip=\"{ props: p, item }\">\n          <VChip\n            v-bind=\"p\"\n            :text=\"`${item.value.name} ${item.value.products_count ? `(${item.value.products_count})` : ''}`\"\n          />\n        </template>\n        <template #item=\"{ props: p, item }\">\n          <VListItem\n            v-bind=\"p\"\n            :title=\"`${item.value.name} ${item.value.products_count ? `(${item.value.products_count})` : ''}`\"\n          />\n        </template>\n      </VAutocomplete>\n      <VCheckbox\n        v-model=\"form.published\" label=\"Publish immediately\"\n      />\n    </div>\n    <VBtn type=\"submit\" color=\"primary\">\n      Submit\n    </VBtn>\n  </VForm>\n</template>\n","<template>\n  <VCard title=\"New Product\" class=\"w-full lg:w-200 mx-auto p-5\">\n    <VCardText>\n      <ProductDetailForm />\n    </VCardText>\n  </VCard>\n</template>\n"],"names":["initForm","initInvalidFeedbacks","router","useRouter","form","reactive","invalidFeedbacks","categories","ref","tags","loading","axios","res","searchTag","useDebounceFn","search","currentTagIds","x","handleSubmit","formData","props","AxiosError","watch","uniqBy","_openBlock","_createBlock","_component_VCard"],"mappings":"wjBAQAA,EAAA,CAAiB,KAAA,GACT,YAAA,KACO,MAAA,KACN,MAAA,EACA,UAAA,GACI,KAAA,CAAA,CACJ,EAGTC,EAAA,CAA6B,KAAA,GACrB,YAAA,GACO,MAAA,GACN,MAAA,GACA,UAAA,EACI,EAGbC,EAAAC,IACAC,EAAAC,EAAA,CAAA,GAAAL,CAAA,CAAA,EACAM,EAAAD,EAAA,CAAA,GAAAJ,CAAA,CAAA,EACAM,EAAAC,EAAA,CAAA,CAAA,EACAC,EAAAD,EAAA,CAAA,CAAA,EACAE,EAAAL,EAAA,CAAyB,KAAA,GACjB,OAAA,EACE,CAAA,EAGVM,EAAA,IAAA,YAAA,EAAA,KAAAC,GAAA,CAEIL,EAAA,MAAAK,EAAA,IAAuB,CAAA,EAG3B,MAAAC,EAAAC,EAAAC,GAAA,CACE,GAAAA,EAAA,SAAA,EAAA,CACEN,EAAA,MAAA,GACA,MAAA,CAEFC,EAAA,OAAA,GACAC,EAAA,IAAA,OAAA,CAAyB,OAAA,CACf,OAAAI,CACN,CACF,CAAA,EAAA,KAAAH,GAAA,CAEA,MAAAI,EAAAZ,EAAA,KAAA,IAAAa,GAAAA,EAAA,EAAA,EAEAR,EAAA,MAAAG,EAAA,KAAA,OAAAK,GAAA,CAAAD,EAAA,SAAAC,EAAA,EAAA,CAAA,EAEAF,IAAA,CAAAH,EAAA,KAAA,QAAAA,EAAA,KAAA,KAAAK,GAAAA,EAAA,OAAAF,CAAA,GACEN,EAAA,MAAA,QAAA,CAAmB,GAAA,EACb,KAAAM,CACE,CAAA,EAGRN,EAAA,MAAAA,EAAA,MAAA,OAAAQ,GAAA,CAAA,CAAAA,EAAA,EAAA,CACF,CAAA,EAAA,QAAA,IAAA,CAEAP,EAAA,OAAA,EAAiB,CAAA,CAClB,EAAA,GAAA,EAGH,eAAAQ,GAAA,CACER,EAAA,KAAA,GACA,OAAA,OAAAJ,EAAAL,CAAA,EAEA,MAAAkB,EAAA,CAAA,GAAAf,GACAe,EAAA,KAAAA,EAAA,KAAA,IAAAF,GAAAA,EAAA,IAAA,EAEA,GAAA,CACE,GAAAG,EAAA,GAAA,CACE,MAAAT,EAAA,IAAA,YAAAS,EAAA,KAAAD,CAAA,EACA,MAAA,CAEF,MAAAP,EAAA,MAAAD,EAAA,KAAA,WAAAQ,CAAA,EACAjB,EAAA,KAAA,aAAAU,EAAA,KAAA,IAAA,CAAsC,OAAA,EAAA,CAEtC,aAAAS,GACE,OAAA,OAAAf,EAAA,EAAA,SAAA,KAAA,MAAA,CAAuD,QAAA,CAEzDI,EAAA,KAAA,EAAe,CACjB,CAGF,OAAAY,EAAA,IAAAlB,EAAA,KAAA,OAAA,IAAA,CACEA,EAAA,KAAAmB,GAAA,QAAA,OAAAnB,EAAA,KAAA,MAAA,CAAoC,CAAA,+0DC1F7B,OAAAoB,EAAA,EAAAC,EAAAC,EAAA,CAAoB,MAAA"}