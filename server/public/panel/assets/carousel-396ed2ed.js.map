{"version":3,"file":"carousel-396ed2ed.js","sources":["../../../../panel/src/pages/settings/carousel.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { sortBy } from 'lodash';\nimport dayjs from 'dayjs';\n\nconst toast = useToast();\nconst approvedCarousels = ref<Carousel[]>([]);\nconst carousels = ref<Carousel[]>([]);\nconst fileHovering = ref(false);\nconst isDirty = ref(false);\n\nfunction fileDragging(e: DragEvent) {\n  e.preventDefault();\n}\n\nfunction fileEnter(e: DragEvent) {\n  e.preventDefault();\n  fileHovering.value = true;\n}\n\nfunction fileExit(e: DragEvent) {\n  e.preventDefault();\n  fileHovering.value = false;\n}\n\nfunction fileDrop(e: DragEvent) {\n  e.preventDefault();\n  fileHovering.value = false;\n  if (e.dataTransfer)\n    addImages(e.dataTransfer.files);\n}\n\nfunction handleChange(e: Event) {\n  const target = e.target as HTMLInputElement;\n\n  if (target.files) {\n    addImages(target.files);\n    target.value = '';\n  }\n}\n\nfunction addImages(images: FileList) {\n  const formData = new FormData();\n\n  for (let i = 0; i < images.length; i++)\n    formData.append('images[]', images[i], images[i].name);\n\n  axios.post<Carousel[]>('carousels', formData)\n    .then((res) => {\n      carousels.value.push(...res.data);\n      carousels.value = sortBy(carousels.value, [x => x.filename?.toLowerCase()]);\n    });\n}\n\nfunction handleApprove(carousel: Carousel) {\n  axios.put<Carousel>(`/carousels/${carousel.id}/approved`)\n    .then((res) => {\n      Object.assign(carousel, res.data);\n\n      approvedCarousels.value.push(carousel);\n      carousels.value = carousels.value.filter(x => !x.approved);\n    });\n}\n\nfunction handleDisapprove(carousel: Carousel) {\n  axios.delete<Carousel>(`/carousels/${carousel.id}/approved`)\n    .then((res) => {\n      Object.assign(carousel, res.data);\n\n      approvedCarousels.value = approvedCarousels.value.filter(x => x.id !== carousel.id);\n      carousels.value.push(carousel);\n      carousels.value = carousels.value.filter(x => !x.approved);\n    });\n}\n\nfunction handleSaveOrder() {\n  const data = approvedCarousels.value.map((x, i) => {\n    x.priority = i + 1;\n    return x;\n  })\n\n  axios.patch('carousels/approved', data).then(() => {\n    approvedCarousels.value = data;\n    toast.success('Carousel order updated.');\n  });\n}\n\nfunction handleDelete(id: number) {\n  axios.delete(`/carousels/${id}`)\n    .then(() => {\n      approvedCarousels.value = approvedCarousels.value.filter(x => x.id !== id);\n      carousels.value = carousels.value.filter(x => x.id !== id);\n    });\n}\n\naxios.get<Carousel[]>('carousels')\n  .then((res) => {\n    carousels.value = res.data;\n    approvedCarousels.value = carousels.value\n      .filter(x => x.approved)\n      .map(x => ({ ...x, priority: x.priority ?? Number.MAX_SAFE_INTEGER }))\n      .sort((a, b) => (a.priority - b.priority) || dayjs(a.approved_at).diff(dayjs(b.approved_at)));\n  });\n\nconst nonApprovedCarousels = computed(() => {\n  return sortBy(carousels.value.filter(x => !x.approved), [x => x.filename?.toLowerCase()]);\n});\n</script>\n\n<template>\n  <VCard title=\"Carousel Setting\">\n    <div class=\"p-5\">\n      <Draggable\n        v-model=\"approvedCarousels\" item-key=\"id\"\n        class=\"flex gap-5 flex-wrap justify-center\"\n        @change=\"(isDirty = true)\"\n      >\n        <template #item=\"{ element }\">\n          <VCard\n            class=\"cursor-pointer rounded-0 !w-50 !flex items-center gap-5 flex-col\" flat\n          >\n            <img draggable=\"false\" class=\"object-cover !w-50 aspect-ratio-16/9\" :src=\"element.url\" />\n            <VCardText class=\"!py-0\">\n              <p class=\"text-center\">\n                {{ element.filename }}\n              </p>\n            </VCardText>\n            <VCardActions class=\"!py-0 flex gap-5 justify-center\">\n              <VBtn icon=\"i-mdi:cancel\" size=\"small\" class=\"!bg-danger !text-black\" @click=\"handleDisapprove(element)\" />\n              <VBtn icon=\"i-mdi:trash-can\" size=\"small\" class=\"!bg-danger !text-black\" @click=\"handleDelete(element.id)\" />\n            </VCardActions>\n          </VCard>\n        </template>\n      </Draggable>\n      <div class=\"text-center\">\n        <VBtn color=\"primary\" @click=\"handleSaveOrder\">\n          Update Carousel Order\n        </VBtn>\n      </div>\n      <VCard\n        class=\"mt-10\"\n        @dragover=\"fileDragging\"\n        @dragenter=\"fileEnter\"\n        @dragexit=\"fileExit\"\n        @drop=\"fileDrop\"\n      >\n        <VOverlay :model-value=\"fileHovering\" persistent contained class=\"items-center justify-center\">\n          <div class=\"i-mdi:upload text-7xl\" />\n          <div class=\"select-none\">\n            Drop Carousel\n          </div>\n        </VOverlay>\n        <VToolbar title=\"Carousels\" color=\"rgba(0,0,0,0)\">\n          <VToolbarItems>\n            <VBtn icon=\"i-ic:round-add\" class=\"!bg-success !text-white\" tag=\"label\" for=\"carousel\" />\n            <input\n              id=\"carousel\" type=\"file\" class=\"w-0 h-0 invisible m-0 p-0\"\n              multiple @change=\"handleChange\"\n            />\n          </VToolbarItems>\n        </VToolbar>\n        <VCardText>\n          <div class=\"flex gap-5 flex-wrap\">\n            <VCard\n              v-for=\"carousel in nonApprovedCarousels\" :key=\"carousel.id\"\n              class=\"cursor-pointer rounded-0 !w-60 !flex items-center gap-5 flex-col\" flat\n            >\n              <img draggable=\"false\" class=\"object-cover !w-60 aspect-ratio-16/9\" :src=\"carousel.url\" />\n              <VCardText class=\"!py-0\">\n                <p class=\"text-center\">\n                  {{ carousel.filename }}\n                </p>\n              </VCardText>\n              <VCardActions class=\"!py-0 flex gap-5\">\n                <VBtn icon=\"i-mdi:check\" size=\"small\" class=\"!bg-success !text-black\" @click=\"handleApprove(carousel)\" />\n                <VBtn icon=\"i-mdi:trash-can\" size=\"small\" class=\"!bg-danger !text-black\" @click=\"handleDelete(carousel.id!)\" />\n              </VCardActions>\n            </VCard>\n          </div>\n        </VCardText>\n      </VCard>\n    </div>\n  </VCard>\n</template>\n"],"names":["toast","useToast","approvedCarousels","ref","carousels","fileHovering","isDirty","fileDragging","fileEnter","fileExit","fileDrop","addImages","handleChange","target","images","formData","i","axios","res","sortBy","x","_a","handleApprove","carousel","handleDisapprove","handleSaveOrder","data","handleDelete","id","b","dayjs","nonApprovedCarousels","computed"],"mappings":"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"}