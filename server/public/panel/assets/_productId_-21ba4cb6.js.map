{"version":3,"file":"_productId_-21ba4cb6.js","sources":["../../../../panel/src/components/Form/ProductImages.vue","../../../../panel/src/pages/products/[productId].vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { pick } from 'lodash';\n\nconst props = defineProps({\n  id: null\n});\nconst state = reactive<{\n  thumbnail_id: number | null\n  images: ProductImage[]\n}>({\n  thumbnail_id: null,\n  images: [],\n});\nconst fileHovering = ref(false);\n\nfunction fileDragging(e: DragEvent) {\n  e.preventDefault();\n}\n\nfunction fileEnter(e: DragEvent) {\n  e.preventDefault();\n  if ((e.dataTransfer?.items.length ?? 0) === 0)\n    return;\n\n  fileHovering.value = true;\n}\n\nfunction fileLeave(e: DragEvent) {\n  e.preventDefault();\n\n  if ((e.target as HTMLElement).id !== 'image-bag')\n    return;\n\n  fileHovering.value = false;\n}\n\nfunction fileDrop(e: DragEvent) {\n  e.preventDefault();\n  fileHovering.value = false;\n  if (e.dataTransfer?.files.length)\n    addImages(e.dataTransfer.files);\n}\n\nfunction handleChange(e: Event) {\n  const target = e.target as HTMLInputElement;\n\n  if (target.files) {\n    addImages(target.files);\n    target.value = '';\n  }\n}\n\nfunction addImages(images: FileList) {\n  const formData = new FormData();\n\n  for (let i = 0; i < images.length; i++)\n    formData.append('images[]', images[i], images[i].name);\n\n  axios.post<ProductImage[]>(`products/${props.id}/images`, formData)\n    .then((res) => {\n      state.images.push(...res.data);\n    });\n}\n\nfunction handleDelete(imageId: number) {\n  axios.delete(`/product-images/${imageId}`)\n    .then(() => {\n      state.images = state.images.filter(x => x.id !== imageId);\n    });\n}\n\nfunction handleReorder(newImages: ProductImage[]) {\n  state.images = newImages.map((x, i) => ({\n    ...x,\n    priority: i + 1,\n  }));\n\n  axios.patch(`/products/${props.id}/images`, state.images);\n}\n\nfunction handleSetAsThumbnail(imageId: number | null) {\n  axios.put(`/products/${props.id}/thumbnail`, {\n    thumbnail_id: imageId,\n  }).then(() => {\n    state.thumbnail_id = imageId;\n  });\n}\n\naxios.get<Product>(`/products/${props.id}`, {\n  params: {\n    select: 'id,thumbnail_id',\n    relations: ['images'],\n  },\n}).then((res) => {\n  Object.assign(state, pick(res.data, ['thumbnail_id', 'images']));\n});\n</script>\n\n<template>\n  <VCard\n    id=\"image-bag\" :class=\"{ 'is-file-hovering': fileHovering }\"\n    @dragover=\"fileDragging\"\n    @dragenter=\"fileEnter\"\n    @dragleave=\"fileLeave\"\n    @drop=\"fileDrop\"\n  >\n    <div\n      class=\"pointer-events-none absolute z-100 top-0 left-0 w-full h-full bg-light bg-opacity-50 items-center justify-center flex flex-col opacity-0 transition\"\n      :class=\"{\n        '!opacity-100': fileHovering,\n      }\"\n    >\n      <div class=\"i-mdi:upload text-7xl text-dark\" />\n      <div class=\"select-none text-dark font-bold\">\n        Drop Image\n      </div>\n    </div>\n    <VToolbar title=\"Product Images\" color=\"rgba(0,0,0,0)\">\n      <VToolbarItems>\n        <VBtn icon=\"i-mdi:plus\" tag=\"label\" class=\"!bg-success !text-white\" for=\"images\" />\n        <input\n          id=\"images\" type=\"file\" class=\"w-0 h-0 invisible m-0 p-0\"\n          multiple accept=\"image/*\" @change=\"handleChange\"\n        />\n      </VToolbarItems>\n    </VToolbar>\n    <VCardText>\n      <Draggable\n        v-if=\"state.images.length > 0\" :model-value=\"state.images\"\n        class=\"flex gap-5 flex-wrap\"\n        @update:model-value=\"handleReorder\"\n      >\n        <template #item=\"{ element }\">\n          <VCard\n            class=\"rounded-0 !w-60 !flex items-center gap-5 flex-col\" flat\n            :class=\"element.id === state.thumbnail_id ? 'border-2 border-gray' : ''\"\n          >\n            <img draggable=\"false\" class=\"object-cover !w-60 aspect-ratio-16/9\" :src=\"element.url\" />\n            <VCardActions class=\"!py-0 flex gap-5\">\n              <VBtn\n                :icon=\"element.id === state.thumbnail_id ? 'i-mdi:image-off' : 'i-mdi:file-image-box'\"\n                size=\"small\" color=\"primary\" @click=\"handleSetAsThumbnail(element.id === state.thumbnail_id ? null : element.id!)\"\n              />\n              <VBtn icon=\"i-mdi:trash-can\" size=\"small\" class=\"text-danger\" @click=\"handleDelete(element.id!)\" />\n            </VCardActions>\n          </VCard>\n        </template>\n      </Draggable>\n      <div v-else-if=\"state.images.length === 0\" class=\"text-3xl text-center py-5 font-bold\">\n        No Images Found\n      </div>\n    </VCardText>\n  </VCard>\n</template>\n","<script setup lang=\"ts\">\nimport type { AxiosError } from 'axios';\n\nconst props = defineProps({\n  productId: null\n});\n\nconst router = useRouter();\nconst toast = useToast();\n\nfunction handleDelete() {\n  axios.delete(`/products/${props.productId}`)\n    .then(() => {\n      router.push('/products');\n    })\n    .catch((res: AxiosError<ApiInvalidFeedback>) => {\n      toast.error(res.response!.data.message!);\n    });\n}\n</script>\n\n<template>\n  <VCard title=\"Edit Product\">\n    <VCardText>\n      <ProductDetailForm :id=\"+productId\" />\n    </VCardText>\n  </VCard>\n  <ProductImages :id=\"+productId\" class=\"mt-5\" />\n  <div class=\"mt-5 text-center\">\n    <VBtn color=\"danger\" @click=\"handleDelete\">\n      DELETE\n    </VBtn>\n  </div>\n</template>\n"],"names":["state","reactive","fileHovering","ref","fileDragging","fileEnter","_a","fileLeave","fileDrop","addImages","handleChange","target","images","formData","i","axios","props","res","handleDelete","imageId","x","handleReorder","newImages","handleSetAsThumbnail","pick","router","useRouter","toast","useToast"],"mappings":"ysBAMAA,EAAAC,EAAA,CAGG,aAAA,KACa,OAAA,CAAA,CACL,CAAA,EAEXC,EAAAC,EAAA,EAAA,EAEA,SAAAC,EAAA,EAAA,CACE,EAAA,eAAA,CAAiB,CAGnB,SAAAC,EAAA,EAAA,OACE,EAAA,eAAA,KACAC,EAAA,EAAA,eAAA,YAAAA,EAAA,MAAA,SAAA,KAAA,IAGAJ,EAAA,MAAA,GAAqB,CAGvB,SAAAK,EAAA,EAAA,CACE,EAAA,eAAA,EAEA,EAAA,OAAA,KAAA,cAGAL,EAAA,MAAA,GAAqB,CAGvB,SAAAM,EAAA,EAAA,OACE,EAAA,eAAA,EACAN,EAAA,MAAA,IACAI,EAAA,EAAA,eAAA,MAAAA,EAAA,MAAA,QACEG,EAAA,EAAA,aAAA,KAAA,CAA8B,CAGlC,SAAAC,EAAA,EAAA,CACE,MAAAC,EAAA,EAAA,OAEAA,EAAA,QACEF,EAAAE,EAAA,KAAA,EACAA,EAAA,MAAA,GACF,CAGF,SAAAF,EAAAG,EAAA,CACE,MAAAC,EAAA,IAAA,SAEA,QAAAC,EAAA,EAAAA,EAAAF,EAAA,OAAAE,IACED,EAAA,OAAA,WAAAD,EAAAE,GAAAF,EAAAE,GAAA,IAAA,EAEFC,EAAA,KAAA,YAAAC,EAAA,YAAAH,CAAA,EAAA,KAAAI,GAAA,CAEIjB,EAAA,OAAA,KAAA,GAAAiB,EAAA,IAAA,CAA6B,CAAA,CAC9B,CAGL,SAAAC,EAAAC,EAAA,CACEJ,EAAA,OAAA,mBAAAI,GAAA,EAAA,KAAA,IAAA,CAEInB,EAAA,OAAAA,EAAA,OAAA,OAAAoB,GAAAA,EAAA,KAAAD,CAAA,CAAwD,CAAA,CACzD,CAGL,SAAAE,EAAAC,EAAA,CACEtB,EAAA,OAAAsB,EAAA,IAAA,CAAAF,EAAAN,KAAA,CAAwC,GAAAM,EACnC,SAAAN,EAAA,CACW,EAAA,EAGhBC,EAAA,MAAA,aAAAC,EAAA,YAAAhB,EAAA,MAAA,CAAwD,CAG1D,SAAAuB,EAAAJ,EAAA,CACEJ,EAAA,IAAA,aAAAC,EAAA,eAAA,CAA6C,aAAAG,CAC7B,CAAA,EAAA,KAAA,IAAA,CAEdnB,EAAA,aAAAmB,CAAqB,CAAA,CACtB,CAGH,OAAAJ,EAAA,IAAA,aAAAC,EAAA,KAAA,CAA4C,OAAA,CAClC,OAAA,kBACE,UAAA,CAAA,QAAA,CACY,CACtB,CAAA,EAAA,KAAAC,GAAA,CAEA,OAAA,OAAAjB,EAAAwB,eAAAP,EAAA,KAAA,CAAA,eAAA,QAAA,CAAA,CAAA,CAA+D,CAAA,8pDCvFjEQ,EAAAC,IACAC,EAAAC,IAEA,SAAAV,GAAA,CACEH,EAAA,OAAA,aAAAC,EAAA,WAAA,EAAA,KAAA,IAAA,CAEIS,EAAA,KAAA,WAAA,CAAuB,CAAA,EAAA,MAAAR,GAAA,CAGvBU,EAAA,MAAAV,EAAA,SAAA,KAAA,OAAA,CAAuC,CAAA,CACxC"}